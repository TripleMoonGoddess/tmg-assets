{
  "always_run_in_app": false,
  "icon": {
    "color": "purple",
    "glyph": "moon"
  },
  "name": "Triple Moon Goddess",
  "script": "// Triple Moon Goddess - Personal Widget\nconst API_URL = 'https://script.google.com/macros/s/AKfycbzrixpvCg1yNeUtIEfvDLJb9JigcsC1MoQrXVyFDCI9krHakKEMcdzYZPlbt6NWqjE9/exec';\nconst LOGO_URL = 'https://raw.githubusercontent.com/TripleMoonGoddess/tmg-assets/main/logo.jpg';\nconst USER_EMAIL = args.widgetParameter || '';\n\nconst SIGN_SYMBOLS = {\n  'Aries': '\u2648', 'Taurus': '\u2649', 'Gemini': '\u264a', 'Cancer': '\u264b',\n  'Leo': '\u264c', 'Virgo': '\u264d', 'Libra': '\u264e', 'Scorpio': '\u264f',\n  'Sagittarius': '\u2650', 'Capricorn': '\u2651', 'Aquarius': '\u2652', 'Pisces': '\u2653'\n};\n\nasync function fetchData() {\n  try {\n    const url = USER_EMAIL \n      ? `${API_URL}?action=personal&email=${encodeURIComponent(USER_EMAIL)}`\n      : `${API_URL}?action=general`;\n    const req = new Request(url);\n    req.timeoutInterval = 30;\n    return await req.loadJSON();\n  } catch (e) {\n    return { error: e.message };\n  }\n}\n\nasync function loadLogo() {\n  try {\n    const req = new Request(LOGO_URL);\n    return await req.loadImage();\n  } catch (e) {\n    return null;\n  }\n}\n\nfunction getOrdinal(n) {\n  if (!n) return '';\n  const num = parseInt(n);\n  const s = ['th', 'st', 'nd', 'rd'];\n  const v = num % 100;\n  return s[(v - 20) % 10] || s[v] || s[0];\n}\n\nfunction applyBackground(widget) {\n  const gradient = new LinearGradient();\n  gradient.locations = [0, 1];\n  gradient.colors = [new Color('#0a0a1a'), new Color('#1a1a2e')];\n  widget.backgroundGradient = gradient;\n}\n\n// ============ SMALL WIDGET ============\nasync function createSmallWidget(data, logo) {\n  const widget = new ListWidget();\n  applyBackground(widget);\n  \n  if (data.chartUrl) widget.url = data.chartUrl;\n  \n  if (data.error) {\n    const err = widget.addText(USER_EMAIL ? '\u26a0\ufe0f Email not found' : '\u26a0\ufe0f Add email');\n    err.textColor = new Color('#ff6b6b');\n    err.font = Font.systemFont(12);\n    return widget;\n  }\n  \n  // Center content vertically\n  widget.addSpacer();\n  \n  // Logo\n  if (logo) {\n    const logoImg = widget.addImage(logo);\n    logoImg.imageSize = new Size(36, 36);\n    logoImg.cornerRadius = 6;\n    logoImg.centerAlignImage();\n  }\n  \n  widget.addSpacer(8);\n  \n  // Moon - compact\n  const moonStack = widget.addStack();\n  moonStack.layoutHorizontally();\n  moonStack.centerAlignContent();\n  const moonEmoji = moonStack.addText(data.moon?.emoji || '\ud83c\udf19');\n  moonEmoji.font = Font.systemFont(18);\n  moonStack.addSpacer(6);\n  const moonText = moonStack.addText(`${data.moon?.sign || ''} ${data.moon?.degree || ''}\u00b0`);\n  moonText.textColor = new Color('#e8e0ff');\n  moonText.font = Font.mediumSystemFont(13);\n  \n  widget.addSpacer(8);\n  \n  // Next Transit - one line\n  if (data.transits?.length > 0) {\n    const t = data.transits[0];\n    const transitText = widget.addText(`${t.transit} \u260c ${t.natal} ${t.daysUntil}d`);\n    transitText.textColor = new Color('#aabbcc');\n    transitText.font = Font.systemFont(11);\n    transitText.centerAlignText();\n  }\n  \n  widget.addSpacer(6);\n  \n  // Retrogrades - compact\n  const retros = data.retrogrades?.active || [];\n  if (retros.length > 0) {\n    const retroText = retros.slice(0, 2).map(r => `${r.planet} Rx`).join(' \u2022 ');\n    const rt = widget.addText(retroText);\n    rt.textColor = new Color('#ff6b6b');\n    rt.font = Font.systemFont(11);\n    rt.centerAlignText();\n  }\n  \n  // Center content vertically\n  widget.addSpacer();\n  \n  return widget;\n}\n\n// ============ MEDIUM WIDGET ============\nasync function createMediumWidget(data, logo) {\n  const widget = new ListWidget();\n  applyBackground(widget);\n  \n  if (data.chartUrl) widget.url = data.chartUrl;\n  \n  if (data.error) {\n    const err = widget.addText(USER_EMAIL ? '\u26a0\ufe0f Email not found' : '\u26a0\ufe0f Add your email');\n    err.textColor = new Color('#ff6b6b');\n    err.font = Font.systemFont(12);\n    return widget;\n  }\n  \n  // Logo\n  if (logo) {\n    const logoImg = widget.addImage(logo);\n    logoImg.imageSize = new Size(36, 36);\n    logoImg.cornerRadius = 6;\n  }\n  \n  widget.addSpacer(4);\n  \n  // Moon\n  const moonStack = widget.addStack();\n  moonStack.layoutHorizontally();\n  moonStack.centerAlignContent();\n  const moonEmoji = moonStack.addText(data.moon?.emoji || '\ud83c\udf19');\n  moonEmoji.font = Font.systemFont(16);\n  moonStack.addSpacer(4);\n  const moonText = moonStack.addText(`Moon in ${data.moon?.sign || ''} ${data.moon?.degree || ''}\u00b0`);\n  moonText.textColor = new Color('#e8e0ff');\n  moonText.font = Font.mediumSystemFont(11);\n  \n  widget.addSpacer(4);\n  \n  // Next Transit\n  if (data.transits?.length > 0) {\n    const t = data.transits[0];\n    const transitHeader = widget.addText('NEXT TRANSIT');\n    transitHeader.textColor = new Color('#666677');\n    transitHeader.font = Font.boldSystemFont(7);\n    widget.addSpacer(1);\n    \n    const transitLine1 = widget.addText(`${t.transit} in ${t.transitSign} (${t.transitHouse}${getOrdinal(t.transitHouse)})`);\n    transitLine1.textColor = new Color('#aabbcc');\n    transitLine1.font = Font.systemFont(9);\n    \n    const transitLine2 = widget.addText(`\u260c ${t.natal} in ${t.natalSign} (${t.natalHouse}${getOrdinal(t.natalHouse)})`);\n    transitLine2.textColor = new Color('#aabbcc');\n    transitLine2.font = Font.systemFont(9);\n    \n    const daysText = widget.addText(`${t.daysUntil} days`);\n    daysText.textColor = new Color('#4a9');\n    daysText.font = Font.systemFont(8);\n    \n    widget.addSpacer(4);\n  }\n  \n  // Personal Retrogrades\n  const retros = data.retrogrades?.active || [];\n  if (retros.length > 0) {\n    const retroHeader = widget.addText('PERSONAL RETROGRADES');\n    retroHeader.textColor = new Color('#666677');\n    retroHeader.font = Font.boldSystemFont(7);\n    widget.addSpacer(1);\n    \n    for (const r of retros.slice(0, 2)) {\n      const houseText = r.house ? ` (${r.house}${getOrdinal(r.house)})` : '';\n      const retroLine = widget.addText(`${r.planet} Rx in ${r.sign}${houseText}`);\n      retroLine.textColor = new Color('#ff6b6b');\n      retroLine.font = Font.systemFont(9);\n      \n      const directLine = widget.addText(`  direct ${r.directDate} (${r.daysUntilDirect}d)`);\n      directLine.textColor = new Color('#ffaa66');\n      directLine.font = Font.systemFont(8);\n    }\n  }\n  \n  return widget;\n}\n\n// ============ LARGE WIDGET ============\nasync function createLargeWidget(data, logo) {\n  const widget = new ListWidget();\n  applyBackground(widget);\n  \n  if (data.chartUrl) widget.url = data.chartUrl;\n  \n  if (data.error) {\n    const err = widget.addText(USER_EMAIL ? '\u26a0\ufe0f Email not found' : '\u26a0\ufe0f Add your email');\n    err.textColor = new Color('#ff6b6b');\n    err.font = Font.systemFont(14);\n    return widget;\n  }\n  \n  // Header with logo\n  const headerStack = widget.addStack();\n  headerStack.layoutHorizontally();\n  headerStack.centerAlignContent();\n  \n  if (logo) {\n    const logoImg = headerStack.addImage(logo);\n    logoImg.imageSize = new Size(50, 50);\n    logoImg.cornerRadius = 10;\n    headerStack.addSpacer(12);\n  }\n  \n  const titleStack = headerStack.addStack();\n  titleStack.layoutVertically();\n  const title = titleStack.addText('Triple Moon Goddess');\n  title.textColor = new Color('#c9b8ff');\n  title.font = Font.boldSystemFont(16);\n  const subtitle = titleStack.addText('Personal Astrology');\n  subtitle.textColor = new Color('#666677');\n  subtitle.font = Font.systemFont(11);\n  \n  widget.addSpacer(12);\n  \n  // Moon section - larger\n  const moonSection = widget.addStack();\n  moonSection.layoutHorizontally();\n  moonSection.centerAlignContent();\n  \n  const moonEmoji = moonSection.addText(data.moon?.emoji || '\ud83c\udf19');\n  moonEmoji.font = Font.systemFont(32);\n  moonSection.addSpacer(10);\n  \n  const moonInfo = moonSection.addStack();\n  moonInfo.layoutVertically();\n  \n  const moonTitle = moonInfo.addText(`Moon in ${data.moon?.sign || ''}`);\n  moonTitle.textColor = new Color('#e8e0ff');\n  moonTitle.font = Font.boldSystemFont(16);\n  \n  const moonDetails = moonInfo.addText(`${data.moon?.degree || ''}\u00b0 \u2022 ${data.moon?.phase || ''}`);\n  moonDetails.textColor = new Color('#888899');\n  moonDetails.font = Font.systemFont(12);\n  \n  widget.addSpacer(12);\n  \n  // Divider\n  const divider1 = widget.addStack();\n  divider1.backgroundColor = new Color('#333344');\n  divider1.size = new Size(0, 1);\n  widget.addSpacer(12);\n  \n  // Transits section\n  if (data.transits?.length > 0) {\n    const transitHeader = widget.addText('UPCOMING TRANSITS');\n    transitHeader.textColor = new Color('#666677');\n    transitHeader.font = Font.boldSystemFont(10);\n    widget.addSpacer(6);\n    \n    for (const t of data.transits.slice(0, 3)) {\n      const tStack = widget.addStack();\n      tStack.layoutHorizontally();\n      \n      const tLeft = tStack.addStack();\n      tLeft.layoutVertically();\n      tLeft.size = new Size(260, 0);\n      \n      const tLine1 = tLeft.addText(`${t.transit} in ${t.transitSign} (${t.transitHouse}${getOrdinal(t.transitHouse)}) \u260c`);\n      tLine1.textColor = new Color('#aabbcc');\n      tLine1.font = Font.systemFont(12);\n      \n      const tLine2 = tLeft.addText(`${t.natal} in ${t.natalSign} (${t.natalHouse}${getOrdinal(t.natalHouse)})`);\n      tLine2.textColor = new Color('#aabbcc');\n      tLine2.font = Font.systemFont(12);\n      \n      tStack.addSpacer();\n      \n      const tDays = tStack.addText(`${t.daysUntil}d`);\n      tDays.textColor = new Color('#4a9');\n      tDays.font = Font.boldSystemFont(14);\n      \n      widget.addSpacer(6);\n    }\n    \n    widget.addSpacer(6);\n  }\n  \n  // Divider\n  const divider2 = widget.addStack();\n  divider2.backgroundColor = new Color('#333344');\n  divider2.size = new Size(0, 1);\n  widget.addSpacer(12);\n  \n  // Retrogrades section\n  const retros = data.retrogrades?.active || [];\n  const retroHeader = widget.addText('PERSONAL RETROGRADES');\n  retroHeader.textColor = new Color('#666677');\n  retroHeader.font = Font.boldSystemFont(10);\n  widget.addSpacer(6);\n  \n  if (retros.length === 0) {\n    const noRetro = widget.addText('No retrogrades affecting your chart \u2728');\n    noRetro.textColor = new Color('#4a9');\n    noRetro.font = Font.systemFont(12);\n  } else {\n    for (const r of retros.slice(0, 4)) {\n      const rStack = widget.addStack();\n      rStack.layoutHorizontally();\n      \n      const rLeft = rStack.addStack();\n      rLeft.layoutVertically();\n      rLeft.size = new Size(220, 0);\n      \n      const houseText = r.house ? ` (${r.house}${getOrdinal(r.house)} house)` : '';\n      const rLine1 = rLeft.addText(`${r.planet} Rx in ${r.sign}${houseText}`);\n      rLine1.textColor = new Color('#ff6b6b');\n      rLine1.font = Font.mediumSystemFont(12);\n      \n      if (r.affects?.length > 0) {\n        const rLine2 = rLeft.addText(`Affecting your ${r.affects.join(', ')}`);\n        rLine2.textColor = new Color('#888899');\n        rLine2.font = Font.systemFont(10);\n      }\n      \n      rStack.addSpacer();\n      \n      const rDirect = rStack.addStack();\n      rDirect.layoutVertically();\n      \n      const rDate = rDirect.addText(r.directDate);\n      rDate.textColor = new Color('#ffaa66');\n      rDate.font = Font.systemFont(11);\n      rDate.rightAlignText();\n      \n      const rDays = rDirect.addText(`${r.daysUntilDirect}d`);\n      rDays.textColor = new Color('#ffaa66');\n      rDays.font = Font.boldSystemFont(12);\n      rDays.rightAlignText();\n      \n      widget.addSpacer(8);\n    }\n  }\n  \n  widget.addSpacer();\n  \n  return widget;\n}\n\n// ============ MAIN ============\nasync function createWidget() {\n  const data = await fetchData();\n  const logo = await loadLogo();\n  const size = config.widgetFamily || 'medium';\n  \n  if (size === 'small') {\n    return createSmallWidget(data, logo);\n  } else if (size === 'large') {\n    return createLargeWidget(data, logo);\n  } else {\n    return createMediumWidget(data, logo);\n  }\n}\n\nconst widget = await createWidget();\nif (config.runsInWidget) {\n  Script.setWidget(widget);\n} else {\n  // Preview - change to test different sizes\n  widget.presentLarge();\n}\nScript.complete();\n",
  "share_sheet_inputs": []
}